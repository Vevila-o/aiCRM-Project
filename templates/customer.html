{% load static %}
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœƒå“¡è©³ç´°è³‡æ–™</title>

    <!-- å…ˆè¼‰å…¥å…±ç”¨ styleï¼Œå†è¼‰å…¥æ­¤é å°ˆç”¨ customer.css -->
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="{% static 'css/customer.css' %}">
</head>
<body>
    <!-- âœ… ç”¨è·Ÿ index.html ä¸€æ¨£çš„ header çµæ§‹ -->
    <header>
        <nav class="navbar">
            <ul>
                <li><a href="/index/">é¦–é </a></li>
                <li><a href="{% url 'history' %}">æ­·å²</a></li>
                <li><a href="/">ç™»å‡º</a></li>
            </ul>
        </nav>
    </header>

    <div class="container">
        <h2 class="section-title">å€‹åˆ¥é¡§å®¢è³‡æ–™</h2>
        {% if member %}
        <div class="main-content">
            <div class="customer-details-header">
                <span class="detail-tag">
                    æœƒå“¡ç·¨è™Ÿ:<span>{{ member.customerID|default:"--" }}</span>
                </span>
                
                <span class="detail-tag">
                    é¡§å®¢å§“å:<span>{{ member.customerName|default:"--" }}</span>
                </span>
                
                <span class="detail-tag">
                    æ€§åˆ¥:<span>{{ member.gender|default:"--" }}</span>
                </span>
                
                <span class="detail-tag">
                    åœ°å€:<span>{{ member.customerRegion|default:"--" }}</span>
                </span>
                
            </div>

            <div class="customer-value-box">
                æ­¤é¡§å®¢ç‚º <span class="highlight-type">{{ member.memberType|default:"æœªåˆ†ç´š" }}</span><br>
                åŠ å…¥æ—¥æœŸï¼š<span>{{ member.customerJoinDay|default:"--" }}</span>
                ç´¯è¨ˆæ¶ˆè²»é‡‘é¡ <span class="highlight-spending">{{ member.totalSpending|default:"0" }}</span> å…ƒ
            </div>
            
            <!-- ğŸ”½ æ’åºé¸å–® -->
            <div class="consumption-toolbar">
                <div class="toolbar-spacer"></div>   <!-- å·¦é‚Šç©ºç™½ï¼Œç”¨ä¾†æ’ç‰ˆé¢ -->
                
                <h3 class="toolbar-title">æ¶ˆè²»ç´€éŒ„</h3>  <!-- ä¸­é–“è¦ç½®ä¸­çš„æ¨™é¡Œ -->
                
                <div class="toolbar-sort">
                    <select id="sortOrder">
                        <option value="desc">æ—¥æœŸï¼šè¿‘ â†’ é </option>
                        <option value="asc">æ—¥æœŸï¼šé  â†’ è¿‘</option>
                    </select>
                </div>
            </div>
            
            
            <!-- ğŸ”½ æ‰€æœ‰æ¶ˆè²»ç´€éŒ„çš„å®¹å™¨ -->
            <div id="consumptionList">
                {% if member.consumptions %}
                {% for c in member.consumptions %}
                    <div class="consumption-record" data-date="{{ c.date }}">
                        <p class="record-date">æ¶ˆè²»æ—¥æœŸ:
                            <span>{{ c.date|default:"--" }}</span>
                        </p>
                        <div class="record-items">
                            <h3>æ¶ˆè²»å“é …</h3>
                            <ul>
                                {% for item in c.items %}
                                    <li>{{ item }}</li>
                                {% endfor %}
                            </ul>
                            <p class="total-amount">
                                é‡‘é¡:<span>{{ c.amount|default:"0" }}</span>å…ƒ
                            </p>
                        </div>
                    </div>
                {% endfor %}
                {% else %}
                    <p class="empty-state">æš«ç„¡æ¶ˆè²»ç´€éŒ„</p>
                {% endif %}
            </div>
            
        </div>
        {% else %}
        <div class="main-content">
            <p class="empty-state">æŸ¥ç„¡é¡§å®¢è³‡æ–™ï¼Œè«‹ç¢ºèªæœƒå“¡ç·¨è™Ÿæˆ–é‡æ–°æœå°‹ã€‚</p>
        </div>
        {% endif %}
    </div>

    <script src="{% static 'js/customer.js' %}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const list = document.getElementById('consumptionList');
            const sortSelect = document.getElementById('sortOrder');
            if (!list || !sortSelect) {
                return;
            }
            const records = Array.from(list.querySelectorAll('.consumption-record'));
            if (!records.length) {
                return;
            }
        
            // é è¨­è³‡æ–™é †åºï¼ˆå…ˆè¨˜èµ·ä¾†ï¼‰
            const originalOrder = [...records];
        
            function render(order) {
                let ordered;
        
                if (order === 'asc') {
                    // ğŸ”¹ æ—¥æœŸé  â†’ è¿‘ï¼šæŒ‰ data-date ç”±å°åˆ°å¤§æ’
                    ordered = [...records].sort((a, b) => {
                        const da = a.dataset.date;
                        const db = b.dataset.date;
                        return da.localeCompare(db);   // å› ç‚ºæ˜¯ YYYY-MM-DDï¼Œå­—ä¸²ä¹Ÿå¯æ’åº
                    });
                } else {
                    // ğŸ”¹ æ—¥æœŸè¿‘ â†’ é ï¼šåéä¾†
                    ordered = [...records].sort((a, b) => {
                        const da = a.dataset.date;
                        const db = b.dataset.date;
                        return db.localeCompare(da);
                    });
                }
        
                // æ¸…ç©º & é‡æ–°æ’å…¥
                list.innerHTML = '';
                ordered.forEach(el => list.appendChild(el));
            }
        
            // åˆæ¬¡è¼‰å…¥ â†’ è¿‘ â†’ é 
            render('desc');
        
            // ä¸‹æ‹‰é¸å–®æ”¹è®Šæ™‚ â†’ é‡æ–°æ’åº
            sortSelect.addEventListener('change', (e) => {
                render(e.target.value);
            });
        });
        </script>
        
</body>
</html>
